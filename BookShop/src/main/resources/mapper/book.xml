<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="book">
	
	<sql id="search">
		select * from book
		<where>
			<if test="search == 1 and keyword.trim() != ''">
				bookId LIKE CONCAT(CONCAT('%',#{keyword}),'%')
			</if>
			<if test="search == 2 and keyword.trim() != ''">
				bookName LIKE CONCAT(CONCAT('%',#{keyword}),'%')
			</if>
			<if test="search == 3 and keyword.trim() != ''">
				publisher LIKE CONCAT(CONCAT('%',#{keyword}),'%')
			</if>
		</where>
	</sql>
	
    <select id="list" resultType="Book">
        select t.*
			from
			    (select t1.*
			            ,rownum rnum
			        from(<include refid="search"></include>)t1) t
		    	<if test="perPage != 0">
		     		where t.rnum between ((#{page}-1) * #{perPage})+1  and ( #{page} * #{perPage} )
		     	</if>
    </select>
    <select id="total" resultType="Integer">
        select count(*) from (<include refid="search"></include>)   
    </select>
    
    <select id="getBook" resultType="Book">
        SELECT * FROM book
        where bookId = #{bookId}
    </select>
   
    <insert id="addBook" parameterType="Book">
    	<selectKey keyProperty="bookId" resultType="int" order="BEFORE">
	    	SELECT book_seq.NEXTVAL FROM DUAL
		</selectKey>
        INSERT INTO book (bookId
							,bookName
							,publisher
							,price
							,pub_date)
        VALUES (#{bookId}, #{bookName}, #{publisher},#{price}, TO_DATE(#{pubDate},'yyyy/MM/dd'))
    </insert> 
    
    <update id="updateBook" parameterType="Book">
        UPDATE book
    	 SET 
    	 	bookName = #{bookName}
			,publisher = #{publisher}
			,price = #{price}
			,pub_date = TO_DATE(#{pubDate},'yyyy/MM/dd')
        WHERE bookId = #{bookId}
    </update>
    
    <delete id="deleteBook" parameterType="Integer">
        DELETE FROM book
        WHERE bookId = #{bookId}
    </delete> 
	
</mapper>